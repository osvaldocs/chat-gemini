<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Chat básico</title>
</head>
<body>
  <h1>Chat</h1>

  <div id="messages" aria-live="polite"></div>

  <form id="form">
    <input id="input" type="text" placeholder="Escribí tu mensaje..." autocomplete="off" />
    <button type="submit">Enviar</button>
  </form>

  <script>
    const form = document.getElementById('form');
    const input = document.getElementById('input');
    const messages = document.getElementById('messages');

    function addMsg(who, text) {
      const p = document.createElement('p');
      p.textContent = `${who}: ${text}`;
      messages.appendChild(p);
      messages.scrollTop = messages.scrollHeight;
    }

    async function sendMessage(text) {
      const res = await fetch('/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: text })
      });

      if (!res.ok) {
        throw new Error('Error en la solicitud: ' + res.status);
      }
      const data = await res.json();
      return data.reply;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const text = input.value.trim();
      if (!text) return;

      addMsg('Vos', text);
      input.value = '';
      input.focus();

      try {
        const reply = await sendMessage(text);
        addMsg('Gemini', reply);
      } catch (err) {
        addMsg('Sistema', 'Hubo un error. Revisá la consola.');
        console.error(err);
      }
    });

    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        form.dispatchEvent(new Event('submit'));
      }
    });
  </script>
</body>
</html>
